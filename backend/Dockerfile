FROM node:20-alpine3.18


WORKDIR /app

RUN npm install -g tsc 

COPY package*.json .

RUN npm install

COPY . .

ARG FRONTEND_URL
ARG BACKEND_PORT
ARG JWT_SECRET
ARG LDAP_HOST
ARG LDAP_PORT
ARG LDAP_USERNAME
ARG LDAP_PASSWORD
ARG LDAP_BASE_DN
ARG LDAP_USERS
ARG LDAP_ADMINS
ARG MAIL_MAILER
ARG MAIL_HOST
ARG MAIL_PORT
ARG MAIL_USERNAME
ARG MAIL_PASSWORD
ARG MAIL_ENCRYPTION
ARG MAIL_FROM_ADDRESS
ARG MAIL_FROM_NAME

ENV FRONTEND_URL $FRONTEND_URL
ENV BACKEND_PORT $BACKEND_PORT
ENV JWT_SECRET $JWT_SECRET
ENV LDAP_HOST $LDAP_HOST
ENV LDAP_PORT $LDAP_PORT
ENV LDAP_USERNAME $LDAP_USERNAME
ENV LDAP_PASSWORD $LDAP_PASSWORD
ENV LDAP_BASE_DN $LDAP_BASE_DN
ENV LDAP_USERS $LDAP_USERS
ENV LDAP_ADMINS $LDAP_ADMINS
ENV MAIL_MAILER $MAIL_MAILER
ENV MAIL_HOST $MAIL_HOST
ENV MAIL_PORT $MAIL_PORT
ENV MAIL_USERNAME $MAIL_USERNAME
ENV MAIL_PASSWORD $MAIL_PASSWORD
ENV MAIL_ENCRYPTION $MAIL_ENCRYPTION
ENV MAIL_FROM_ADDRESS $MAIL_FROM_ADDRESS
ENV MAIL_FROM_NAME $MAIL_FROM_NAME 


EXPOSE 3000

LABEL Name=udl√•nsystem-backend

RUN npx prisma migrate




 CMD ["npm", "run", "run-prod"]
